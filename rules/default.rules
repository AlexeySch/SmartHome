import org.openhab.core.library.types.*
import org.openhab.core.persistence.*
import org.openhab.model.script.actions.* 

String prev_UPS_status = "OB"

rule "SMS on Power state chage"
	when
		Item UPS_Status changed or
		System started 
	then
		String message = ""
		String phone = "+79065480824"
		if(UPS_Status=="OL" && prev_UPS_status == "OB") {
			message = "System/Power is up";
			logInfo("Power", message)
		}

		if(UPS_Status=="OB" && prev_UPS_status == "OL") {
			message = "Power is down !!!"
			logInfo("Power", message)
		}
		if (message != ""){
			String cmd = "To: " + phone +"\n\n" + message + "> /var/tmp/sms"
			logInfo("SMS", cmd)
			executeCommandLine(cmd)
		}
		
		
		prev_UPS_status = UPS_Status
end

rule "Test Rule"
	when
		Time cron "* * * * * ?" 
	then
		String message = ""
		String phone = "+79065480824"
			message = "System/Power is up";

			String cmd = "To: " + phone +"\n\n" + message + "> /var/tmp/sms"
			logInfo("SMS", cmd)
			executeCommandLine(cmd)
end
